#!/bin/bash

set -e

early_abort=false

if ! command -v pyenv >/dev/null 2>&1; then
  git clone git://github.com/pyenv/pyenv ~/.pyenv
  echo 'export PYENV_ROOT="${HOME}/.pyenv"' >> ~/.bashrc
  echo 'export PATH="${PYENV_ROOT}/bin:${PATH}"' >> ~/.bashrc
  echo -e 'if command -v pyenv >/dev/null 2>&1; then\n  eval "$(pyenv init -)"\nfi' >> ~/.bashrc
  early_abort=true
fi

if ! dpkg -s python-dev
then
  sudo apt-get -y install python-dev
fi

if [ "${early_abort}" == "true" ]; then
  printf "Please run 'exec \${SHELL}', then run this program again. Exiting.\n"
  exit 0
fi

pip install -r requirements.txt
ansible-playbook -v -K -i inventory localhost.yml
